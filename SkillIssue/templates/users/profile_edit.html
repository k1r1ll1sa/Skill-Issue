{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚Äî Skill Issue</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
<header class="header" id="header">
    <nav class="header-container">
        <a class="logo" href="{% url 'main_page' %}">Skill Issue</a>
        <div class="nav-group nav-group-left">
            <a class="nav-links" href="{% url 'guides_list' %}" data-lang-ru="—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞" data-lang-en="guides">—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞</a>
            <a class="nav-links" href="{% url 'announcements_list' %}" data-lang-ru="–æ–±—ä—è–≤–ª–µ–Ω–∏—è" data-lang-en="announcements">–æ–±—ä—è–≤–ª–µ–Ω–∏—è</a>
        </div>
        <div class="nav-group nav-group-right">
            <div class="search-container">
                    <input class="search" placeholder="–ø–æ–∏—Å–∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤, –∞–Ω–∫–µ—Ç –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π" id="searchInput"
                           data-placeholder-ru="–ø–æ–∏—Å–∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤, –∞–Ω–∫–µ—Ç –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π"
                           data-placeholder-en="search guides, profiles and announcements">
                    <div class="search-dropdown" id="searchDropdown">
                    </div>
            </div>
            <button id="theme-toggle" onclick="window.toggleTheme(event)" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
            <a class="nav-links" id="language-toggle" href="#" onclick="toggleLanguage(event)" title="–°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫">RU</a>
            <div class="menu-container">
                {% if user.is_authenticated %}
                    <a class="nav-links"
                       href="{% url 'profile_page' user.username %}"
                       data-lang-ru="–ø—Ä–æ—Ñ–∏–ª—å"
                       data-lang-en="profile"
                       style="margin-right: 24px;">–ø—Ä–æ—Ñ–∏–ª—å</a>
                {% else %}
                    <a class="nav-links" href="{% url 'login_page' %}" data-lang-ru="–≤–æ–π—Ç–∏" data-lang-en="log in">–≤–æ–π—Ç–∏</a>
                    <div class="context-menu">
                        <a href="{% url 'register_page' %}" data-lang-ru="–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è" data-lang-en="register">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                        <a href="{% url 'login_page' %}" data-lang-ru="–≤–æ–π—Ç–∏" data-lang-en="log in">–≤–æ–π—Ç–∏</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </nav>
</header>

<div class="body-background">
    <form id="profile-form" method="POST" enctype="multipart/form-data" style="text-align:center;">
        {% csrf_token %}
        <div class="profile-row-container">
            <div class="image-container" style="position:relative; display:inline-block;">
                {% if profile.avatar %}
                    <img id="profile-image" src="{{ profile.avatar.url }}" alt="avatar" style="padding:20px; width:250px; height:250px; border-radius:50%;">
                {% else %}
                    <img id="profile-image" src="{% static 'images/default-avatar.jpg' %}" alt="avatar" style="padding:20px; width:250px; height:250px; border-radius:50%;">
                {% endif %}
                <div class="hover-text" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); opacity:0; transition:opacity 0.3s;">
                    <label for="file-input" class="simple-text" style="color:white; background:rgba(0,0,0,0.7); padding:5px 10px; border-radius:5px; cursor:pointer;"
                           data-lang-ru="–≤—ã–±—Ä–∞—Ç—å"
                           data-lang-en="choose">–≤—ã–±—Ä–∞—Ç—å</label>
                    <input id="file-input" name="avatar" type="file" accept="image/*" style="display:none;">
                </div>
            </div>

            <div class="profile-column-container" style="min-width:67%;">
                <input id="username-input" name="username" class="profile-input" value="{{ user.username }}"
                       style="font-size:1.5rem; padding:20px 20px 0 0;"
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º"
                       data-placeholder-ru="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º"
                       data-placeholder-en="Enter nickname">
                <hr style="color:black; width:100%;">
                <input id="description-input" name="description" class="profile-input"
                   value="{{ profile.bio|default:'' }}"
                   style="font-size:1.3rem; padding:0 20px 20px 0; width:100%;"
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ"
                   data-placeholder-ru="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ"
                   data-placeholder-en="Enter description">
                <a class="simple-text" style="font-size:1rem; padding:20px 20px 5px 0;"
                   data-lang-ru="–†–µ–π—Ç–∏–Ω–≥: {{ profile.rating|default:"0" }}/5"
                   data-lang-en="Rating: {{ profile.rating|default:"0" }}/5">–†–µ–π—Ç–∏–Ω–≥: {{ profile.rating|default:"0" }}/5</a>
            </div>
        </div>
        <button id="save-button" type="submit" class="profile-button" style="margin:20px 0; width:200px; height:35px;"
                data-lang-ru="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
                data-lang-en="Save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
</div>

<footer class="footer">
    <div class="footer-container">
        <table class="simple-text" style="width:100%; height:100%; color:lightgray; font-size:1rem;">
            <tr>
                <td colspan="3" style="width:33%;">
                    <a href="https://www.sfu.ru/ru" class="nav-group-left" style="text-decoration:none; color:lightgray; margin-top:5px; font-size:1.25rem;"
                       data-lang-ru="–°–∏–±–∏—Ä—Å–∫–∏–π –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç"
                       data-lang-en="Siberian Federal University">–°–∏–±–∏—Ä—Å–∫–∏–π –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</a>
                </td>
                <td style="text-align:right;">
                    <p class="nav-group-right" style="margin-top:5px; font-size:1.25rem;">@skill_issue 2025</p>
                </td>
            </tr>
            <tr>
                <td><p style="text-align:left;">@bukohm</p></td>
                <td><p style="text-align:center;">@hoolkayyy</p></td>
                <td><p style="text-align:right;">@K1rkaSs</p></td>
            </tr>
        </table>
    </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const imgContainer = document.querySelector('.image-container');
    const hoverText = imgContainer.querySelector('.hover-text');
    const fileInput = document.getElementById('file-input');
    const img = document.getElementById('profile-image');
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get("updated") === "1") {
        const lang = localStorage.getItem('lang') || 'RU';
        const msg = lang === 'RU' ? "‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!" : "‚úÖ Profile updated successfully!";
        alert(msg);
        const newUrl = window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
    }

    imgContainer.addEventListener('mouseenter', () => hoverText.style.opacity = '1');
    imgContainer.addEventListener('mouseleave', () => hoverText.style.opacity = '0');

    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(ev) {
                img.src = ev.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
});
</script>
<script src="{% static 'js/search.js' %}"></script>
<script src="{% static 'js/toggle_language.js' %}"></script>
<script src="{% static 'js/theme.js' %}"></script>
</body>
</html>